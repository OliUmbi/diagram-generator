<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>diagram-generator</title>
    <link rel="stylesheet" href="normalize.css" />
    <link rel="stylesheet" href="style.css" />
    <script src="script.js"></script>
</head>

<body>
    <div class="editor">
        <button onclick="drawClasses()">reload</button>
        <textarea id="editor" cols="30" rows="50" spellcheck="false">
-- tables
CREATE TABLE Persons
(
    personId int NOT NULL AUTO_INCREMENT primary key,
    LastName varchar(255) NOT NULL,
    FirstName varchar(255),
    Age int,
    foreign key (lastname) references security_accounts (id)
);
drop table if exists security_accounts cascade;
create table security_accounts
(
    id       serial primary key,
    email    varchar(255),
    password varchar(255),
    role     int
);

drop table if exists security_tokens cascade;
create table security_tokens
(
    id      serial primary key,
    account int,
    refresh varchar(255),
    access  varchar(255),
    expires timestamp
);

drop table if exists security_access cascade;
create table security_access
(
    id   serial primary key,
    name varchar(255),
    edit bool
);

drop table if exists security_roles cascade;
create table security_roles
(
    id   serial primary key,
    role varchar(255)
);

drop table if exists security_roles_access cascade;
create table security_roles_access
(
    id     serial primary key,
    role   int,
    access int
);

-- foreign keys
alter table security_accounts
    add foreign key (role) references security_roles (id);

alter table security_tokens
    add foreign key (account) references security_accounts (id);

alter table security_roles_access
    add foreign key (role) references security_roles (id);
alter table security_roles_access
    add foreign key (access) references security_access (id);

-- unique
alter table security_accounts
    add unique (email);

alter table security_roles
    add unique (role);

alter table security_tokens
    add unique (access);
alter table security_tokens
    add unique (refresh);

alter table security_roles_access
    add unique (role, access);
        </textarea>
    </div>
    <div class="canvas">
        <svg id="canvas" width="100%" height="100%" onload="makeDraggable(evt)">
            <style>
                .draggable, .draggable-group {
                    cursor: move;
                }
                text {
                    font-size: 14px;
                }
                .head {
                    dominant-baseline: middle;
                    text-anchor: middle;
                    font-size: 16px;
                }
                .box {
                    fill: white;
                    stroke: black;
                }
                line {
                    stroke: black;
                }
            </style>
            <defs>
                <marker id="agg" markerWidth="30" markerHeight="30" 
                refX="30" refY="15" orient="auto">
                    <polygon points="0 15, 15 22, 30 15, 15 8" stroke="black" fill="white" />
                </marker>
                <marker id="com" markerWidth="30" markerHeight="30" 
                refX="30" refY="15" orient="auto" markerUnits="strokeWidth">
                <polygon points="0 15, 15 22, 30 15, 15 8" stroke="black" fill="black" />
            </marker>
            </defs>
            <g transform="translate(500, 20)" width="300" height="600" class="draggable-group">
                <rect x="0" y="0" width="200" height="50" class="box"></rect>
                <text x="100" y="15" class="head">&lt;&lt;Table&gt;&gt;</text>
                <text x="100" y="35" class="head" font-weight="bold">Person</text>
                <rect x="0" y="50" width="200" height="200" class="box"></rect>
                <text x="10" y="70">id : int {not null}</text>
                <text x="10" y="90">Hello</text>
                <text x="10" y="110">Hello</text>
                <text x="10" y="130">Hello</text>
                <text x="10" y="150">Hello</text>
            </g>
            <line x1="300" y1="300" x2="100" y2="100" marker-end="url(#agg)" marker-start="url(#com)" />
            <text x="290" y="290">1..*</text>
            <text x="90" y="90">1</text>
        </svg>
        <button onclick="drawClasses()" hidden>reload</button>
    </div>
</body>

</html>